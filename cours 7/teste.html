<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/d3/7.4.4/d3.min.js'></script>
    <script>
                const canevas = d3.select("body").append("svg")
                .attr("width", 1000)
                .attr("height", 2000);

                d3.csv('villagers.csv',function(d){
                return {
                nom : d.Name,
                espece : d.Species,
                genre : d.Gender,
                personnalite : d.Personality,
                hobbie : d.Hobby,
                signe : d.Sign,
                style : d.Style1,
            }

            }).then(donnees =>{
                
                // TEST
               const Personality = d3.group(donnees, d => d.personnalite)
               //console.log("tableau à partir des personnalités :", Personality)

               const PersonalityLazy  = Personality.get("Lazy")
              // console.log("tableau à partir des personnalités Lazy et leur nombre :", PersonalityLazy, PersonalityLazy.length)

               const PersonalitySigne = d3.group(donnees, d=> d.signe, d => d.personnalite )
               //console.log("tableau à partir des personnalités et des Signe :", PersonalitySigne)

               const PersonalitySigneGenre = d3.group(donnees,  d => d.genre, d => d.personnalite, d => d.signe,  )
               //console.log("tableau à partir des personnalités et des Signe et du genre :", PersonalitySigneGenre)

               const PersonalitySignMale = PersonalitySigneGenre.get("Male")
               
               //console.log(" les Male avec leur signe et personnalité :", PersonalitySignMale)
               const PersonalitySignFemale = PersonalitySigneGenre.get("Female")
               //console.log(" les Female avec leur signe et personnalité :", PersonalitySignFemale)
               const PersonalitySignMaleArray = Array.from(PersonalitySignMale) 
               //console.log(PersonalitySignMaleArray)

               const PersonalityLazyTaurus  = PersonalitySigne.get("Taurus").get("Lazy")
               //console.log("tableau à partir des personnalités Lazy et  du Signe Taurus et leur nombre:", PersonalityLazyTaurus, PersonalityLazyTaurus.length)

               const NombrePersonnalite = d3.rollups(donnees, v => v.length, d => d.personnalite)
               //console.log("tableau du nbr de voisins par personnalité :", NombrePersonnalite)

               const leMoindreNombrePersonnalite = d3.least(d3.rollup(donnees, v => v.length, d => d.personnalite))
               //console.log("tableau du plus petit nombre de voisins par personnalité :", leMoindreNombrePersonnalite)

               const lePlusNombrePersonnalite = d3.greatest(d3.rollup(donnees, v => v.length, d => d.personnalite))
               //console.log("tableau du plus grand nombre de voisins par personnalité :", lePlusNombrePersonnalite) // marche pas

               const laSommeDesPersonnalité = d3.sum(NombrePersonnalite, (d) => d[1]) 
               // console.log("nombre de voisin avec une personnalité :", laSommeDesPersonnalité)


                /*
                // test pour faire un tableau avec les differente personnalité masi sans prendre en compte le genre et le signe
                
                const canevas = d3.select("body").append("svg")
                .attr("width", 960)
                .attr("height", 500);

                const chiffre = [1,2,3,4,5,6,7,8]
                 
                const NombrePersonnaliteEtChiffre = d3.zip(NombrePersonnalite,chiffre)
                //console.log(NombrePersonnaliteEtChiffre)


                const x = d3.scaleBand()
                .domain(["Lazy", "Jock", "Snooty", "Peppy", "Cranky", "Normal", "Big Sister", "Smug",])
                .range([0, 350])

                const y = d3.scaleLinear()
                .domain([0, 60])
                .range([300, 150]);

            

                canevas.selectAll("rect")
                .data(NombrePersonnaliteEtChiffre)
                .enter()
                .append("rect")
                    .attr("x", d => 200 -x.bandwidth() + d[1]*x.bandwidth())
                    .attr("y", d => 350 - y(120-d[0][1]))
                    .attr("width", x.bandwidth())
                    .attr("height", d => y(120-d[0][1]))
                    .style('fill','pink')
                    .style('stroke','hotpink');

                

                canevas.append("g")
                    .attr("transform", 'translate(200,350)')
                    .call(d3.axisBottom(x));
                    
                canevas.append("g")
                    .attr("transform", 'translate(200,50)')
                    .call(d3.axisLeft(y));
                */    
            // MEME CHOSE MAIS AVEC UN TRI PAR SEXE _ SIGNE _ pour toutes les PERSONNALITES
                
                const Signe = d3.group(donnees, d => d.signe, d=> d.genre, d => d.personnalite )

                const CapricornusMalePersonnalite = Signe.get("Capricornus").get("Male")
                const CapricornusMalePersonnaliteArray = Array.from(CapricornusMalePersonnalite) 

                const CapricornusFemalePersonnalite = Signe.get("Capricornus").get("Female")
                const CapricornusFemalePersonnaliteArray = Array.from(CapricornusFemalePersonnalite) 

                // en fonction des données 
                CapricornusMalePersonnaliteArray.push(["Big Sister", []],["Peppy", []],["Normal", []],["Snooty", []])
                CapricornusFemalePersonnaliteArray.push(["Cranky", []],["Jock", []],["Lazy", []],["Smug", []])
                CapricornusMalePersonnaliteArray.sort(d3.ascending)
                CapricornusFemalePersonnaliteArray.sort(d3.ascending) 

                const chiffreSigne = [1,2,3,4,5,6,7,8]
                const CapricornusMalePersonnaliteArrayEtChiffre = d3.zip(CapricornusMalePersonnaliteArray,chiffreSigne)
                const CapricornusFemalePersonnaliteArrayEtChiffre = d3.zip(CapricornusFemalePersonnaliteArray,chiffreSigne)
                //console.log(CapricornusMalePersonnaliteArray, CapricornusFemalePersonnaliteArray)


                const xSigne = d3.scaleBand()
                .domain(["Big Sister", "Cranky", "Jock", "Lazy",  "Normal", "Peppy", "Smug", "Snooty"])
                .range([0, 350])

                const ySign = d3.scaleLinear()
                .domain([0, 10])
                .range([300, 150]);

                canevas.append("g")
                    .attr("transform", 'translate(200,250)')
                    .call(d3.axisBottom(xSigne));
                    
                canevas.append("g")
                    .attr("transform", 'translate(200,-50)')
                    .call(d3.axisLeft(ySign));
                
                canevas.selectAll("rect")
                .data(CapricornusFemalePersonnaliteArrayEtChiffre)
                .enter()
                .append("rect")
                    .attr("x", d => 200 -xSigne.bandwidth() + d[1]*xSigne.bandwidth() + xSigne.bandwidth()/2)
                    .attr("y", d => 250 - ySign(20- d[0][1].length))
                    .attr("width", xSigne.bandwidth()/2)
                    .attr("height", d => ySign(20 - d[0][1].length))
                    .style('fill','pink')
                    .style('stroke','hotpink')
                .exit()
                .data(CapricornusMalePersonnaliteArrayEtChiffre)
                .enter()
                .append("rect")
                    .attr("x", d => 200 -xSigne.bandwidth() + d[1]*xSigne.bandwidth())
                    .attr("y", d => 250 - ySign(20- d[0][1].length))
                    .attr("width", xSigne.bandwidth()/2)
                    .attr("height", d => ySign(20 - d[0][1].length))
                    .style('fill','LightSkyBlue')
                    .style('stroke','RoyalBlue')
                
            // MEME CHOSE MAIS AVEC UN TRI PAR SEXE _ SIGNE _ TOUS les Hobby 
                
                const Hobby = d3.group(donnees, d => d.signe, d=> d.genre, d => d.hobbie )
                
                const CapricornusMaleHobbies = Hobby.get("Capricornus").get("Male")
                const CapricornusMaleHobbiesArray = Array.from(CapricornusMaleHobbies)

                const CapricornusFemaleHobbies = Hobby.get("Capricornus").get("Female")
                const CapricornusFemaleHobbiesArray = Array.from(CapricornusFemaleHobbies)

                // en fonction des données 
                CapricornusMaleHobbiesArray.push(["Fashion", []])
                CapricornusFemaleHobbiesArray.push(["Fitness", []])
                CapricornusMaleHobbiesArray.sort(d3.ascending)
                CapricornusFemaleHobbiesArray.sort(d3.ascending) 
                

                const chiffreHobbies = [1,2,3,4,5,6,7,8]
                const CapricornusMaleHobbiesArrayEtChiffre = d3.zip(CapricornusMaleHobbiesArray,chiffreHobbies)
                const CapricornusFemaleHobbiesArrayEtChiffre = d3.zip(CapricornusFemaleHobbiesArray,chiffreHobbies)
                //console.log(CapricornusFemaleHobbiesArray,CapricornusMaleHobbiesArray )
            
                 const xHobby = d3.scaleBand()
                 .domain(["Education", "Fashion","Fitness",  "Music", "Nature", "Play"])
                 .range([0, 350])
 
                 const yHobby = d3.scaleLinear()
                 .domain([0, 10])
                 .range([300, 150]);
 
                 canevas.append("g")
                     .attr("transform", 'translate(200,450)')
                     .call(d3.axisBottom(xHobby));
                     
                 canevas.append("g")
                     .attr("transform", 'translate(200,150)')
                     .call(d3.axisLeft(yHobby));
 
                 canevas.selectAll("rect")
                 .exit()
                 .data(CapricornusFemaleHobbiesArrayEtChiffre)
                 .enter()
                 .append("rect")
                     .attr("x", d => 200 - xHobby.bandwidth() + d[1]*xHobby.bandwidth()+ xHobby.bandwidth()/2)
                     .attr("y", d => 450 - yHobby(20- d[0][1].length))
                     .attr("width", xHobby.bandwidth()/2)
                     .attr("height", d => yHobby(20 - d[0][1].length))
                     .style('fill','pink')
                     .style('stroke','hotpink')
                .exit()
                .data(CapricornusMaleHobbiesArrayEtChiffre)
                .enter()
                .append("rect")
                    .attr("x", d => 200 -xHobby.bandwidth() + d[1]*xHobby.bandwidth())
                    .attr("y", d => 450 - yHobby(20- d[0][1].length))
                    .attr("width", xHobby.bandwidth()/2)
                    .attr("height", d => yHobby(20 - d[0][1].length))
                    .style('fill','LightSkyBlue')
                    .style('stroke','RoyalBlue');
 
            //diagramme en barre des ESPECE par SIGNE et par GENRE 

                const Espece = d3.group(donnees, d => d.signe, d=> d.genre, d => d.espece)
                
                const CapricornusMaleEspece = Espece.get("Capricornus").get("Male")
                const CapricornusMaleEspeceArray = Array.from(CapricornusMaleEspece)

                const CapricornusFemaleEspece = Espece.get("Capricornus").get("Female")
                const CapricornusFemaleEspecesArray = Array.from(CapricornusFemaleEspece)

                // en fonction des données 
                CapricornusMaleEspeceArray.sort(d3.ascending)
                CapricornusFemaleEspecesArray.sort(d3.ascending) 
                //console.log(CapricornusFemaleEspecesArray,CapricornusMaleEspeceArray)

                const chiffreEspece = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35]
                const CapricornusMaleEspeceArrayEtChiffre = d3.zip(CapricornusMaleEspeceArray,chiffreEspece)
                const CapricornusFemaleEspeceArrayEtChiffre = d3.zip(CapricornusFemaleEspecesArray,chiffreEspece)
                //console.log(CapricornusFemaleEspeceArrayEtChiffre,CapricornusMaleEspeceArrayEtChiffre)

                // je suis ici : je dois essayer de créer un tableau avec les espece et des chiffre de 1 à 35 et une couleur
                const ECouleur = d3.groups(donnees, d => d.espece)
                let Couleur = ECouleur[1].shift()
                console.log(Couleur)

                const xEspece = d3.scaleBand()
                    .domain(["Male", "Female"])
                    .range([300, 150])
 
                const yEspece= d3.scaleLinear()
                    .domain([1, 15])
                    .range([0, 350]);
 
                canevas.append("g")
                    .attr("transform", 'translate(200,350)')
                    .call(d3.axisLeft(xEspece));
                     
                canevas.append("g")
                    .attr("transform", 'translate(200,650)')
                    .call(d3.axisBottom(yEspece));

                canevas.selectAll("rect")
                 .exit()
                 .data(CapricornusFemaleEspeceArrayEtChiffre)
                 .enter()
                 .append("rect")
                     .attr("x", d => 200 - xEspece.bandwidth() + d[1]*xEspece.bandwidth()+ xEspece.bandwidth()/2)
                     .attr("y", d => 450 - yEspece(20- d[0][1].length))
                     .attr("width", xEspece.bandwidth()/2)
                     .attr("height", d => yEspece(20 - d[0][1].length))
                     .style('fill','pink')
                     .style('stroke','hotpink')
                .exit()
                .data(CapricornusMaleHobbiesArrayEtChiffre)
                .enter()
                .append("rect")
                    .attr("x", d => 200 -xEspece.bandwidth() + d[1]*xEspece.bandwidth())
                    .attr("y", d => 450 - yEspece(20- d[0][1].length))
                    .attr("width", xEspece.bandwidth()/2)
                    .attr("height", d => yEspece(20 - d[0][1].length))
                    .style('fill','LightSkyBlue')
                    .style('stroke','RoyalBlue');
                
            
            })

     </script>

            
</body>
</html>


